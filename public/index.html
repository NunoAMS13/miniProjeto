const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://miniprojeto2324.documents.azure.com:443/";
const key = "PA98XhkQ1aIL5n3ICgmj13YDip514b2mXTmEwktqWK7cyIxrIodJz5bqAWQfpjO7oAKr7iLsJMPOACDbtiZQqA==";
const databaseId = "MiniProjeto";
const containerId = "Receitas";

const client = new CosmosClient({ endpoint, key });

module.exports = async function (context, myTimer) {
    if (myTimer.isPastDue) {
        context.log('A execução da função está atrasada.');
    }

    try {
        const { database } = await client.databases.createIfNotExists({ id: databaseId });
        const { container } = await database.containers.createIfNotExists({ id: containerId });
        context.log('Conexão com Cosmos DB estabelecida com sucesso.');
    } catch (error) {
        context.log.error('Falha ao conectar à Cosmos DB:', error);
        context.done(error); // Termina a execução da função com erro
        return;
    }

    context.done(); // Termina a execução da função sem erro
};
